<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HR â€” Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (XLSX)</title>

<!-- SheetJS for XLSX -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
  :root{
    --bg:#0f172a;           /* Ø®Ù„ÙÙŠØ© Ø¹Ø§Ù…Ø© */
    --panel:#0b1324;        /* Ø¨Ø·Ø§Ù‚Ø© */
    --text:#e5e7eb;         /* Ù†Øµ */
    --muted:#94a3b8;        /* Ø«Ø§Ù†ÙˆÙŠ */
    --ok:#14532d;           /* Ù…Ø·Ø§Ø¨Ù‚ */
    --bad:#581c1b;          /* Ù…Ø®Ø§Ù„Ù */
    --warn:#374151;         /* Ù†Ø§Ù‚Øµ */
    --ok-border:#22c55e33;
    --bad-border:#ef444433;
    --warn-border:#9ca3af33;
    --chip:#111827;
    --brand:#2dd4bf;
  }
  *{box-sizing:border-box}
  body{
    background:var(--bg);
    color:var(--text);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Arabic", "Arial", sans-serif;
    margin:0; padding:24px 10px 80px;
  }
  h1{font-size:22px;margin:0 0 12px;display:flex;gap:8px;align-items:center}
  .wrap{max-width:1100px;margin:0 auto;display:flex;flex-direction:column;gap:16px}
  .card{
    background:var(--panel);
    border:1px solid #1f2937;
    border-radius:12px; padding:14px;
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .hint{color:var(--muted);font-size:12px}
  .box{
    border:1px dashed #334155; border-radius:12px; padding:12px;
    background:#0b1222;
  }
  input[type=file]{
    display:block; width:100%;
    padding:10px; background:#0a0f1e;border:1px solid #334155;border-radius:10px;color:var(--text)
  }
  .btn{
    background:#0a0f1e;border:1px solid #334155;color:var(--text);
    padding:10px 14px;border-radius:10px;cursor:pointer
  }
  .btn.primary{background:#0b1324;border-color:#1f3a5f}
  .btn.green{background:#064e3b;border-color:#065f46}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .kpis{display:flex;gap:10px;flex-wrap:wrap}
  .kpis .chip{
    background:var(--chip); border:1px solid #334155; color:var(--text);
    border-radius:999px; padding:8px 12px; font-size:13px; display:flex; gap:8px; align-items:center; cursor:pointer;
  }
  .kpis .chip[data-active="true"]{outline:2px solid var(--brand)}
  .kpis .chip.ok{border-color:var(--ok-border)}
  .kpis .chip.bad{border-color:var(--bad-border)}
  .kpis .chip.warn{border-color:var(--warn-border)}

  /* Ø¬Ø¯ÙˆÙ„ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ± Ø¯Ø§Ø®Ù„ Ø¥Ø·Ø§Ø± Ø«Ø§Ø¨Øª */
  .table-shell{
    background:#0a0f1e; border:1px solid #1f2937; border-radius:12px;
    overflow:auto; /* Ø£ÙÙ‚ÙŠ ÙˆØ¹Ù…ÙˆØ¯ÙŠ */
  }
  table{min-width:1200px; width:100%; border-collapse:separate; border-spacing:0}
  th,td{padding:10px 12px; border-bottom:1px solid #1f2937; white-space:nowrap; font-size:14px}
  th{
    position:sticky; top:0; background:#0b1324; z-index:1; text-align:center;
  }
  td{text-align:center}

  /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø§Ø´Ø© ÙÙ‚Ø· */
  .tag{padding:6px 10px;border-radius:8px;display:inline-block}
  .tag.ok{background:var(--ok);border:1px solid var(--ok-border)}
  .tag.bad{background:var(--bad);border:1px solid var(--bad-border)}
  .tag.warn{background:var(--warn);border:1px solid var(--warn-border)}

  .footer{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}
  .sticky-actions{display:flex;gap:8px;flex-wrap:wrap}

  @media (max-width:700px){
    h1{font-size:18px}
    th,td{font-size:13px; padding:8px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ§® HR â€” Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (XLSX)</h1>

    <!-- Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª -->
    <div class="card">
      <div class="row">
        <div style="flex:1" class="box">
          <b>ğŸ“‚ Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø© (XLSX)</b>
          <div class="hint">Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: <code>Ø§Ù„ÙƒÙˆØ¯ | Ø§Ù„Ø§Ø³Ù… | Øº | Ø±</code></div>
          <input id="fp" type="file" accept=".xlsx,.xls" />
          <div class="hint" id="fpInfo"></div>
        </div>
        <div style="flex:1" class="box">
          <b>ğŸ“ Ø§Ù„ÙƒØ´Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ (XLSX)</b>
          <div class="hint">Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: <code>Ø§Ù„ÙƒÙˆØ¯ | Ø§Ù„Ø§Ø³Ù… | Øº | Ø±</code></div>
          <input id="man" type="file" accept=".xlsx,.xls" />
          <div class="hint" id="manInfo"></div>
        </div>
      </div>

      <div class="row sticky-actions" style="margin-top:10px">
        <button class="btn primary" id="run" disabled>ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</button>
        <button class="btn green" id="dl" disabled>ğŸ’¾ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ XLSX</button>
        <div class="hint" id="totals"></div>
      </div>
    </div>

    <!-- ÙÙ„Ø§ØªØ± -->
    <div class="card">
      <div class="kpis" id="filters">
        <div class="chip" data-filter="all" data-active="true">Ø§Ù„ÙƒÙ„ <span id="c_all">0</span></div>
        <div class="chip ok" data-filter="match">Ù…Ø·Ø§Ø¨Ù‚ <span id="c_match">0</span></div>
        <div class="chip bad" data-filter="diff">Ù…Ø®Ø§Ù„Ù <span id="c_diff">0</span></div>
        <div class="chip warn" data-filter="missing">Ù†Ø§Ù‚Øµ/ØºÙŠØ± Ù…ÙƒØªÙ…Ù„ <span id="c_missing">0</span></div>
      </div>
    </div>

    <!-- Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
    <div class="card">
      <div class="table-shell">
        <table id="tbl">
          <thead>
            <tr>
              <th>Ù…</th>
              <th>Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)</th>
              <th>Ø§Ù„Ø§Ø³Ù… (Ø¨ØµÙ…Ø©)</th>
              <th>Øº (Ø¨ØµÙ…Ø©)</th>
              <th>Ø± (Ø¨ØµÙ…Ø©)</th>
              <th>Ø§Ù„ÙƒÙˆØ¯ (ÙŠØ¯ÙˆÙŠ)</th>
              <th>Ø§Ù„Ø§Ø³Ù… (ÙŠØ¯ÙˆÙŠ)</th>
              <th>Øº (ÙŠØ¯ÙˆÙŠ)</th>
              <th>Ø± (ÙŠØ¯ÙˆÙŠ)</th>
              <th>Ù†ØªÙŠØ¬Ø© Øº</th>
              <th>Ù†ØªÙŠØ¬Ø© Ø±</th>
              <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="footer">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© - Ø§Ù„ÙŠÙ…Ù† â€¢ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³/ Ø­Ù…Ø¯ÙŠ Ø§Ù„Ø¹Ø±ÙŠÙ‚ÙŠ Øª: 7773143600 â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù†ÙˆÙÙ…Ø¨Ø± 2025Ù…</div>
    </div>
  </div>

<script>
/* -------------------- Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© -------------------- */
// Ù‚Ø±Ø§Ø¡Ø© ÙˆØ±Ù‚Ø© Ø£ÙˆÙ„Ù‰ ÙƒÙƒØ§Ø¦Ù†Ø§Øª
function readXLSX(file){
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onload = e=>{
      const wb = XLSX.read(new Uint8Array(e.target.result), {type:'array',cellDates:true});
      const ws = wb.Sheets[wb.SheetNames[0]];
      const json = XLSX.utils.sheet_to_json(ws, {defval:""});
      resolve(json);
    };
    reader.onerror = reject;
    reader.readAsArrayBuffer(file);
  });
}

// ØªÙ‚Ø±ÙŠØ¨ Ø¢Ù…Ù† Ù„Ù…Ø±ØªÙŠÙ† Ø¹Ø´Ø±ÙŠØªÙŠÙ†
const round2 = (val)=>{
  if(val===null || val===undefined || val==="") return 0;
  const n = parseFloat(String(val).toString().replace(/,/g,""));
  if(isNaN(n)) return 0;
  return Math.round((n + Number.EPSILON)*100)/100;
};

// ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ø§Ø³Ù… (Ø¥Ø²Ø§Ù„Ø© Ù…Ø³Ø§ÙØ§Øª Ø²Ø§Ø¦Ø¯Ø©)
const normName = s => String(s||"").replace(/\s+/g," ").trim();

// Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©: Ø§Ù„ÙƒÙˆØ¯ + Ø§Ù„Ø§Ø³Ù…
const keyOf = r => `${String(r["Ø§Ù„ÙƒÙˆØ¯"]).trim()}__${normName(r["Ø§Ù„Ø§Ø³Ù…"])}`;

/* -------------------- Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© -------------------- */
let FP=[], MAN=[], RESULT=[], FILTER="all";

/* -------------------- Ø¹Ù†Ø§ØµØ± DOM -------------------- */
const $ = sel => document.querySelector(sel);
const fpEl = $("#fp"), manEl = $("#man"), runEl = $("#run"), dlEl = $("#dl");
const fpInfo = $("#fpInfo"), manInfo = $("#manInfo"), totals = $("#totals");
const tbody = $("#tbl tbody");

/* -------------------- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª -------------------- */
async function handleFile(ev, target){
  const f = ev.target.files[0];
  if(!f) return;
  const rows = await readXLSX(f);

  // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
  const need = ["Ø§Ù„ÙƒÙˆØ¯","Ø§Ù„Ø§Ø³Ù…","Øº","Ø±"];
  const hasAll = need.every(c=>Object.keys(rows[0]||{}).includes(c));
  if(!hasAll){ alert("ØªÙ†Ø¨ÙŠÙ‡: ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø§Ù„ÙˆØ±Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ø§Ù„ÙƒÙˆØ¯ | Ø§Ù„Ø§Ø³Ù… | Øº | Ø±"); ev.target.value=""; return; }

  // ØªØ·Ø¨ÙŠØ¹ ÙˆØªØ­ÙˆÙŠÙ„ Ø£Ø±Ù‚Ø§Ù…
  rows.forEach(r=>{
    r["Ø§Ù„ÙƒÙˆØ¯"] = String(r["Ø§Ù„ÙƒÙˆØ¯"]).trim();  // ÙŠØ¯Ø¹Ù… Ø£ÙƒÙˆØ§Ø¯ Ø·ÙˆÙŠÙ„Ø© Ù…Ø«Ù„ 50465
    r["Ø§Ù„Ø§Ø³Ù…"] = normName(r["Ø§Ù„Ø§Ø³Ù…"]);
    r["Øº"] = round2(r["Øº"]);
    r["Ø±"] = round2(r["Ø±"]);
  });

  if(target==="fp"){ FP = rows; fpInfo.textContent = `ØªÙ… Ø±ÙØ¹: ${f.name} â€” ${rows.length} ØµÙÙ‹Ø§`; }
  else { MAN = rows; manInfo.textContent = `ØªÙ… Ø±ÙØ¹: ${f.name} â€” ${rows.length} ØµÙÙ‹Ø§`; }

  runEl.disabled = !(FP.length && MAN.length);
  dlEl.disabled = true;
  RESULT = []; render([], true);
}

fpEl.addEventListener("change", e=>handleFile(e,"fp"));
manEl.addEventListener("change", e=>handleFile(e,"man"));

/* -------------------- Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© -------------------- */
function compare(){
  const mapMan = new Map();
  MAN.forEach(m=> mapMan.set(keyOf(m), m));

  const out = [];

  FP.forEach(f=>{
    const k = keyOf(f);
    const m = mapMan.get(k);

    if(!m){
      out.push({
        idx: 0,
        "Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)": f["Ø§Ù„ÙƒÙˆØ¯"], "Ø§Ù„Ø§Ø³Ù… (Ø¨ØµÙ…Ø©)": f["Ø§Ù„Ø§Ø³Ù…"],
        "Øº (Ø¨ØµÙ…Ø©)": f["Øº"], "Ø± (Ø¨ØµÙ…Ø©)": f["Ø±"],
        "Ø§Ù„ÙƒÙˆØ¯ (ÙŠØ¯ÙˆÙŠ)": "", "Ø§Ù„Ø§Ø³Ù… (ÙŠØ¯ÙˆÙŠ)": "",
        "Øº (ÙŠØ¯ÙˆÙŠ)": "", "Ø± (ÙŠØ¯ÙˆÙŠ)": "",
        "Ù†ØªÙŠØ¬Ø© Øº": "Ù†Ø§Ù‚Øµ", "Ù†ØªÙŠØ¬Ø© Ø±": "Ù†Ø§Ù‚Øµ",
        "Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©": "Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ© Ø£Ùˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„ÙƒØ´Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ",
        _state: "missing"
      });
      return;
    }

    const gF = round2(f["Øº"]), gM = round2(m["Øº"]);
    const rF = round2(f["Ø±"]), rM = round2(m["Ø±"]);

    let resG = "Ù…Ø·Ø§Ø¨Ù‚", resR = "Ù…Ø·Ø§Ø¨Ù‚", note = "Ù…Ø·Ø§Ø¨Ù‚", state="match";

    if(gF !== gM){
      resG = "Ù…Ø®Ø§Ù„Ù";
      state = "diff";
      if(gF > gM) note = "ÙŠØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Øº";
      else note = `Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ø¯Ø®Ø§Ù„ ÙŠØªÙ… Ø¹Ù…Ù„ Ø§Ø³ØªÙŠÙØ§Ø¡ Øº Ø¨Ø§Ù„ÙØ§Ø±Ù‚ ${(gM-gF).toFixed(1)}`;
    }
    if(rF !== rM){
      resR = "Ù…Ø®Ø§Ù„Ù";
      state = "diff";
      if(rF > rM) note = (note==="Ù…Ø·Ø§Ø¨Ù‚") ? "ÙŠØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø±" : note;
      else note = (note==="Ù…Ø·Ø§Ø¨Ù‚") ? `Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ø¯Ø®Ø§Ù„ ÙŠØªÙ… Ø¹Ù…Ù„ Ø± Ø¨Ø§Ù„ÙØ§Ø±Ù‚ ${(rM-rF).toFixed(1)}` : note;
    }

    out.push({
      idx: 0,
      "Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)": f["Ø§Ù„ÙƒÙˆØ¯"], "Ø§Ù„Ø§Ø³Ù… (Ø¨ØµÙ…Ø©)": f["Ø§Ù„Ø§Ø³Ù…"],
      "Øº (Ø¨ØµÙ…Ø©)": gF, "Ø± (Ø¨ØµÙ…Ø©)": rF,
      "Ø§Ù„ÙƒÙˆØ¯ (ÙŠØ¯ÙˆÙŠ)": m["Ø§Ù„ÙƒÙˆØ¯"], "Ø§Ù„Ø§Ø³Ù… (ÙŠØ¯ÙˆÙŠ)": m["Ø§Ù„Ø§Ø³Ù…"],
      "Øº (ÙŠØ¯ÙˆÙŠ)": gM, "Ø± (ÙŠØ¯ÙˆÙŠ)": rM,
      "Ù†ØªÙŠØ¬Ø© Øº": resG, "Ù†ØªÙŠØ¬Ø© Ø±": resR,
      "Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©": note,
      _state: state
    });
  });

  // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ÙƒÙˆØ¯ ØªØµØ§Ø¹Ø¯ÙŠÙ‹Ø§
  out.sort((a,b)=> Number(a["Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)"]) - Number(b["Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)"]));

  // ØªØ±Ù‚ÙŠÙ… Ø¹Ù…ÙˆØ¯ Ù…
  out.forEach((r,i)=> r.idx = i+1);

  return out;
}

/* -------------------- Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -------------------- */
function render(rows, clearCounters){
  tbody.innerHTML = "";
  const fragment = document.createDocumentFragment();

  let all=0, match=0, diff=0, missing=0;

  (rows||[]).forEach(r=>{
    all++;
    if(r._state==="match") match++;
    else if(r._state==="diff") diff++;
    else missing++;

    // ÙÙ„ØªØ±Ø©
    if(FILTER==="match" && r._state!=="match") return;
    if(FILTER==="diff" && r._state!=="diff") return;
    if(FILTER==="missing" && r._state!=="missing") return;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.idx}</td>
      <td>${r["Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)"]}</td>
      <td style="text-align:right">${r["Ø§Ù„Ø§Ø³Ù… (Ø¨ØµÙ…Ø©)"]}</td>
      <td>${r["Øº (Ø¨ØµÙ…Ø©)"]}</td>
      <td>${r["Ø± (Ø¨ØµÙ…Ø©)"]}</td>
      <td>${r["Ø§Ù„ÙƒÙˆØ¯ (ÙŠØ¯ÙˆÙŠ)"]||""}</td>
      <td style="text-align:right">${r["Ø§Ù„Ø§Ø³Ù… (ÙŠØ¯ÙˆÙŠ)"]||""}</td>
      <td>${r["Øº (ÙŠØ¯ÙˆÙŠ)"]===""?"":r["Øº (ÙŠØ¯ÙˆÙŠ)"]}</td>
      <td>${r["Ø± (ÙŠØ¯ÙˆÙŠ)"]===""?"":r["Ø± (ÙŠØ¯ÙˆÙŠ)"]}</td>
      <td><span class="tag ${r["Ù†ØªÙŠØ¬Ø© Øº"]==="Ù…Ø·Ø§Ø¨Ù‚"?"ok":(r["Ù†ØªÙŠØ¬Ø© Øº"]==="Ù…Ø®Ø§Ù„Ù"?"bad":"warn")}">${r["Ù†ØªÙŠØ¬Ø© Øº"]}</span></td>
      <td><span class="tag ${r["Ù†ØªÙŠØ¬Ø© Ø±"]==="Ù…Ø·Ø§Ø¨Ù‚"?"ok":(r["Ù†ØªÙŠØ¬Ø© Ø±"]==="Ù…Ø®Ø§Ù„Ù"?"bad":"warn")}">${r["Ù†ØªÙŠØ¬Ø© Ø±"]}</span></td>
      <td style="text-align:right">${r["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©"]||""}</td>
    `;
    fragment.appendChild(tr);
  });

  tbody.appendChild(fragment);

  if(clearCounters!==false){
    $("#c_all").textContent = all;
    $("#c_match").textContent = match;
    $("#c_diff").textContent = diff;
    $("#c_missing").textContent = missing;
    totals.textContent = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${all} | Ù…Ø·Ø§Ø¨Ù‚: ${match} | Ù…Ø®Ø§Ù„Ù: ${diff} | Ù†Ø§Ù‚Øµ: ${missing} â€” Ù…Ù„Ø§Ø­Ø¸Ø©: ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØªÙ… Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­.`;
  }
}

/* -------------------- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -------------------- */
runEl.addEventListener("click", ()=>{
  RESULT = compare();
  render(RESULT);
  dlEl.disabled = RESULT.length===0;
});

// ÙÙ„Ø§ØªØ±
document.getElementById("filters").addEventListener("click",(e)=>{
  const chip = e.target.closest(".chip");
  if(!chip) return;
  document.querySelectorAll(".chip").forEach(c=>c.dataset.active="false");
  chip.dataset.active="true";
  FILTER = chip.dataset.filter || "all";
  render(RESULT, false);
});

// ØªÙ†Ø²ÙŠÙ„ XLSX
dlEl.addEventListener("click", ()=>{
  if(!RESULT.length) return;

  // ØªØ¬Ù‡ÙŠØ² ØµÙÙˆÙ Ù„Ù„Ù…Ù„Ù Ø¨Ù†ÙØ³ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
  const rows = RESULT.map(r=>({
    "Ù…": r.idx,
    "Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)": r["Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)"],
    "Ø§Ù„Ø§Ø³Ù… (Ø¨ØµÙ…Ø©)": r["Ø§Ù„Ø§Ø³Ù… (Ø¨ØµÙ…Ø©)"],
    "Øº (Ø¨ØµÙ…Ø©)": r["Øº (Ø¨ØµÙ…Ø©)"],
    "Ø± (Ø¨ØµÙ…Ø©)": r["Ø± (Ø¨ØµÙ…Ø©)"],
    "Ø§Ù„ÙƒÙˆØ¯ (ÙŠØ¯ÙˆÙŠ)": r["Ø§Ù„ÙƒÙˆØ¯ (ÙŠØ¯ÙˆÙŠ)"],
    "Ø§Ù„Ø§Ø³Ù… (ÙŠØ¯ÙˆÙŠ)": r["Ø§Ù„Ø§Ø³Ù… (ÙŠØ¯ÙˆÙŠ)"],
    "Øº (ÙŠØ¯ÙˆÙŠ)": r["Øº (ÙŠØ¯ÙˆÙŠ)"],
    "Ø± (ÙŠØ¯ÙˆÙŠ)": r["Ø± (ÙŠØ¯ÙˆÙŠ)"],
    "Ù†ØªÙŠØ¬Ø© Øº": r["Ù†ØªÙŠØ¬Ø© Øº"],
    "Ù†ØªÙŠØ¬Ø© Ø±": r["Ù†ØªÙŠØ¬Ø© Ø±"],
    "Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©": r["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©"]
  }));

  const ws = XLSX.utils.json_to_sheet(rows, {header:[
    "Ù…","Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)","Ø§Ù„Ø§Ø³Ù… (Ø¨ØµÙ…Ø©)","Øº (Ø¨ØµÙ…Ø©)","Ø± (Ø¨ØµÙ…Ø©)",
    "Ø§Ù„ÙƒÙˆØ¯ (ÙŠØ¯ÙˆÙŠ)","Ø§Ù„Ø§Ø³Ù… (ÙŠØ¯ÙˆÙŠ)","Øº (ÙŠØ¯ÙˆÙŠ)","Ø± (ÙŠØ¯ÙˆÙŠ)",
    "Ù†ØªÙŠØ¬Ø© Øº","Ù†ØªÙŠØ¬Ø© Ø±","Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©"
  ]});
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "canary_monthly_result");
  XLSX.writeFile(wb, "canary_monthly_result.xlsx");
});
</script>
</body>
</html>
