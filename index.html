<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Canary HR â€“ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</title>
  <meta name="description" content="Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙƒÙˆØ¯ + Ø§Ù„Ø§Ø³Ù… Ø«Ù… Ù…Ù‚Ø§Ø±Ù†Ø© Øº / Ø± Ø¨ÙŠÙ† Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø© ÙˆØ§Ù„ÙŠØ¯ÙˆÙŠ Ù…Ø¹ ØªÙ„ÙˆÙŠÙ† ÙˆØ´Ø±Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠ.">

  <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© xlsx Ù‚Ø¨Ù„ Ø£ÙŠ ÙƒÙˆØ¯ ÙŠØ³ØªØ®Ø¯Ù…Ù‡Ø§ -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.20.2/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg:#0f172a;          /* Ø£Ø²Ø±Ù‚ ÙƒØ­Ù„ÙŠ Ø¯Ø§ÙƒÙ† */
      --card:#0b1226;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#1e3a8a;      /* Ø£Ø²Ø±Ù‚ */
      --pill:#1d4ed8;        /* Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ */
      --ok:#16a34a;          /* Ø£Ø®Ø¶Ø± */
      --bad:#7f1d1d;         /* Ø®Ù…Ø±ÙŠ */
      --miss:#6b7280;        /* Ø±Ù…Ø§Ø¯ÙŠ */
      --line:#1f2937;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",Tahoma,sans-serif}
    .wrap{max-width:1100px;margin:auto;padding:20px}
    h1{font-weight:800;margin:8px 0 18px}
    .muted{color:var(--muted)}
    .grid{display:grid;gap:14px}
    @media(min-width:880px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:linear-gradient(180deg,var(--card),#0a1124);border:1px solid var(--line);border-radius:14px;padding:14px}
    .drop{border:2px dashed #334155;border-radius:12px;padding:18px;text-align:center;opacity:.95}
    .drop input{display:none}
    .drop b{display:inline-flex;align-items:center;gap:8px}
    .hint{font-size:.85rem;color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{padding:8px 14px;border-radius:999px;font-weight:700}
    .pill.ok{background:var(--ok)}
    .pill.bad{background:var(--bad)}
    .pill.miss{background:var(--miss)}
    .pill.info{background:var(--pill)}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .btn{background:#111827;border:1px solid #374151;color:#e5e7eb;border-radius:999px;padding:8px 14px;cursor:pointer}
    .btn.active{background:var(--accent)}
    table{width:100%;border-collapse:collapse;margin-top:10px;border-radius:12px;overflow:hidden}
    thead th{background:#0b1735;color:#cbd5e1;padding:10px;border-bottom:1px solid #27324b;white-space:nowrap}
    tbody td{padding:10px;border-bottom:1px solid #1f2937;vertical-align:middle}
    tbody tr.ok{background:rgba(22,163,74,.12)}
    tbody tr.bad{background:rgba(127,29,29,.12)}
    tbody tr.miss{background:rgba(107,114,128,.12)}
    .name{max-width:340px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .num{text-align:center}
    .foot{margin:18px 0 8px;color:var(--muted);font-size:.9rem;border-top:1px solid #1f2937;padding-top:10px}
    .search{width:100%;padding:10px;border-radius:10px;border:1px solid #334155;background:#0b1226;color:#e5e7eb}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙƒÙ†Ø§Ø±ÙŠ Ù„Ù„ØµÙ†Ø§Ø¹Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© â€” <span style="color:#60a5fa">HR</span></h1>
    <div class="muted">Ù…Ø·Ø§Ø¨Ù‚Ø©: Ø§Ù„ÙƒÙˆØ¯ + <b>Ø§Ù„Ø§Ø³Ù…</b> Ø«Ù… Ù…Ù‚Ø§Ø±Ù†Ø© <b>Øº / Ø±</b> Ø¨ÙŠÙ† Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø© ÙˆØ§Ù„ÙŠØ¯ÙˆÙŠØŒ Ù…Ø¹ ØªÙ„ÙˆÙŠÙ† ÙˆØ´Ø±Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠ.</div>

    <div class="grid" style="margin-top:16px">
      <!-- Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø© -->
      <div class="card">
        <h3>ğŸ“ Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø© (Ø´Ù‡Ø±ÙŠ)</h3>
        <label class="drop" id="bioDrop">
          <input id="bioFile" type="file" accept=".xlsx,.xls,.csv" />
          <b>Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</b>
          <div class="hint" id="bioHint">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù.</div>
        </label>
      </div>

      <!-- Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ -->
      <div class="card">
        <h3>ğŸ“ Ø§Ù„ÙƒØ´Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ (Ø´Ù‡Ø±ÙŠ)</h3>
        <label class="drop" id="manDrop">
          <input id="manFile" type="file" accept=".xlsx,.xls,.csv" />
          <b>Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</b>
          <div class="hint" id="manHint">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù.</div>
        </label>
      </div>
    </div>

    <div class="row" style="margin-top:14px">
      <span class="pill ok">Ù…Ø·Ø§Ø¨Ù‚ <span id="okCount">0</span></span>
      <span class="pill bad">Ù…Ø®Ø§Ù„Ù <span id="badCount">0</span></span>
      <span class="pill miss">Ù†Ø§Ù‚Øµ <span id="missCount">0</span></span>
      <span class="pill info">ØªÙ… ØªØ­Ù…ÙŠÙ„: <span id="loadCount">0</span> / <span id="totalCount">0</span></span>
    </div>

    <input id="q" class="search" placeholder="...Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯">

    <div class="toolbar">
      <button class="btn active" data-filter="all">Ø§Ù„ÙƒÙ„</button>
      <button class="btn" data-filter="ok">Ù…Ø·Ø§Ø¨Ù‚</button>
      <button class="btn" data-filter="bad">Ù…Ø®Ø§Ù„Ù</button>
      <button class="btn" data-filter="miss">Ù†Ø§Ù‚Øµ</button>
      <button class="btn" id="dl">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ XLSX ğŸ’¾</button>
    </div>

    <div class="card">
      <table id="tbl">
        <thead>
          <tr>
            <th class="num">Ù…</th>
            <th class="num">(Ø¨ØµÙ…Ø©) Ø§Ù„ÙƒÙˆØ¯</th>
            <th>(Ø¨ØµÙ…Ø©) Ø§Ù„Ø§Ø³Ù…</th>
            <th class="num">(Ø¨ØµÙ…Ø©) Øº</th>
            <th class="num">(Ø¨ØµÙ…Ø©) Ø±</th>
            <th class="num">(ÙŠØ¯ÙˆÙŠ) Ø§Ù„ÙƒÙˆØ¯</th>
            <th>(ÙŠØ¯ÙˆÙŠ) Ø§Ù„Ø§Ø³Ù…</th>
            <th class="num">(ÙŠØ¯ÙˆÙŠ) Øº</th>
            <th class="num">(ÙŠØ¯ÙˆÙŠ) Ø±</th>
            <th>Ù†ØªÙŠØ¬Ø© Ø±</th>
            <th>Ù†ØªÙŠØ¬Ø© Øº</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="foot">
        Â© Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙƒÙ†Ø§Ø±ÙŠ Ù„Ù„ØµÙ†Ø§Ø¹Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© â€” ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­. |
        Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© |
        Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³/ Ø­Ù…Ø¯ÙŠ Ø§Ù„Ø¹Ø±ÙŠÙ‚ÙŠ â€” Øª: 773143600 â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€” Ù†ÙˆÙÙ…Ø¨Ø± Â© 2025
      </div>
    </div>
  </div>

  <script>
    // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù…Ø­Ù…Ù‘Ù„Ø©
    if (!window.XLSX) {
      alert("ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© XLSX Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. Ø±Ø¬Ø§Ø¡Ù‹ ØªØ­Ù‚Ù‘Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø«Ù… Ø£Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„.");
    }

    // Ø¹Ù†Ø§ØµØ± DOM
    const bioFile = document.getElementById('bioFile');
    const manFile = document.getElementById('manFile');
    const bioHint = document.getElementById('bioHint');
    const manHint = document.getElementById('manHint');
    const q = document.getElementById('q');
    const tbody = document.querySelector('#tbl tbody');
    const counts = { ok:0, bad:0, miss:0, total:0, loaded:0 };
    const okC = document.getElementById('okCount');
    const badC = document.getElementById('badCount');
    const missC = document.getElementById('missCount');
    const loadC = document.getElementById('loadCount');
    const totalC = document.getElementById('totalCount');
    const btns = document.querySelectorAll('.btn[data-filter]');
    const dlBtn = document.getElementById('dl');

    let bio = [];   // [{code,name,g,r}]
    let man = [];
    let merged = []; // Ø§Ù„Ù†ØªØ§Ø¦Ø¬

    // Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Excel Ø¹Ø§Ù…Ù‘Ø©
    async function readExcel(file){
      return new Promise((resolve, reject)=>{
        const reader = new FileReader();
        reader.onload = e=>{
          try{
            const wb = XLSX.read(new Uint8Array(e.target.result), {type:'array'});
            const ws = wb.Sheets[wb.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(ws, {defval:""});
            resolve(rows);
          }catch(err){ reject(err); }
        };
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
      });
    }

    // ØªØ·Ø¨ÙŠØ¹ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
    function normalizeRow(row){
      const get = (...keys)=> {
        for(const k of keys){
          if (k in row) return String(row[k]).trim();
        }
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¬Ø²Ø¦ÙŠØ©
        const low = Object.fromEntries(Object.entries(row).map(([k,v])=>[k.replace(/\s+/g,''), v]));
        for(const k of keys){
          const kk = k.replace(/\s+/g,'');
          if (kk in low) return String(low[kk]).trim();
        }
        return "";
      };

      // Ù…ÙØ§ØªÙŠØ­ Ø´Ø§Ø¦Ø¹Ø©
      const code = get("Ø§Ù„ÙƒÙˆØ¯","Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)","ÙƒÙˆØ¯","code","CODE");
      const name = get("Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ø§Ø³Ù… (Ø¨ØµÙ…Ø©)","Ø§Ø³Ù…","name","NAME");
      const g = Number(get("Øº","Øº (Ø¨ØµÙ…Ø©)","ØºÙŠØ§Ø¨","G")) || 0;
      const r = Number(get("Ø±","Ø± (Ø¨ØµÙ…Ø©)","ØªØ£Ø®ÙŠØ±","R")) || 0;

      return { code: String(code).replace(/[^\d]/g,''), name, g, r };
    }

    function toDict(arr){
      const d = {};
      for(const r of arr){
        if(!r.code) continue;
        // Ø¥Ù† ØªØ¹Ø¯Ø¯ Ø§Ù„ÙƒÙˆØ¯ Ù†Ø£Ø®Ø° Ø£ÙˆÙ„ ÙˆØ§Ø­Ø¯
        if(!(r.code in d)) d[r.code] = r;
      }
      return d;
    }

    function merge(){
      const b = toDict(bio);
      const m = toDict(man);
      const codes = Array.from(new Set([...Object.keys(b), ...Object.keys(m)]))
        .filter(Boolean)
        .sort((a,b)=> Number(a)-Number(b));

      merged = codes.map((code, idx)=>{
        const B = b[code] || {code,name:"",g:"",r:""};
        const M = m[code] || {code,name:"",g:"",r:""};
        // Ø§Ù„Ø­ÙƒÙ…
        let tag="ok";
        if(!B.name || !M.name){ tag="miss"; }
        else if (String(B.name).trim() !== String(M.name).trim() || Number(B.g)!=Number(M.g) || Number(B.r)!=Number(M.r)){
          tag="bad";
        }
        return {
          idx: idx+1,
          code_b: B.code||"",
          name_b: B.name||"",
          g_b: B.g===""? "": Number(B.g),
          r_b: B.r===""? "": Number(B.r),
          code_m: M.code||"",
          name_m: M.name||"",
          g_m: M.g===""? "": Number(M.g),
          r_m: M.r===""? "": Number(M.r),
          tag
        };
      });

      counts.ok = merged.filter(x=>x.tag==="ok").length;
      counts.bad = merged.filter(x=>x.tag==="bad").length;
      counts.miss = merged.filter(x=>x.tag==="miss").length;
      counts.total = merged.length;
      counts.loaded = Math.max(bio.length, man.length);

      okC.textContent = counts.ok;
      badC.textContent = counts.bad;
      missC.textContent = counts.miss;
      loadC.textContent = counts.loaded;
      totalC.textContent = counts.total;

      render();
    }

    function render(){
      const fActive = document.querySelector('.btn.active')?.dataset.filter || "all";
      const query = q.value.trim();
      const re = query? new RegExp(query.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')): null;

      tbody.innerHTML = "";
      let i=1;
      for(const row of merged){
        if(fActive!=="all" && row.tag!==fActive) continue;
        if(re){
          const hay = `${row.code_b} ${row.name_b} ${row.code_m} ${row.name_m}`;
          if(!re.test(hay)) continue;
        }
        const tr = document.createElement('tr');
        tr.className = row.tag;
        tr.innerHTML = `
          <td class="num">${i++}</td>
          <td class="num">${row.code_b||""}</td>
          <td class="name" title="${row.name_b||""}">${row.name_b||""}</td>
          <td class="num">${row.g_b===""?"":row.g_b}</td>
          <td class="num">${row.r_b===""?"":row.r_b}</td>
          <td class="num">${row.code_m||""}</td>
          <td class="name" title="${row.name_m||""}">${row.name_m||""}</td>
          <td class="num">${row.g_m===""?"":row.g_m}</td>
          <td class="num">${row.r_m===""?"":row.r_m}</td>
          <td>${(row.r_b===row.r_m)?"Ù…Ø·Ø§Ø¨Ù‚ Ø±":"Ù…Ø®Ø§Ù„Ù Ø±"}</td>
          <td>${(row.g_b===row.g_m)?"Ù…Ø·Ø§Ø¨Ù‚ Øº":"Ù…Ø®Ø§Ù„Ù Øº"}</td>
        `;
        tbody.appendChild(tr);
      }
    }

    // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    dlBtn.addEventListener('click', ()=>{
      const rows = [["Ù…","(Ø¨ØµÙ…Ø©) Ø§Ù„ÙƒÙˆØ¯","(Ø¨ØµÙ…Ø©) Ø§Ù„Ø§Ø³Ù…","(Ø¨ØµÙ…Ø©) Øº","(Ø¨ØµÙ…Ø©) Ø±","(ÙŠØ¯ÙˆÙŠ) Ø§Ù„ÙƒÙˆØ¯","(ÙŠØ¯ÙˆÙŠ) Ø§Ù„Ø§Ø³Ù…","(ÙŠØ¯ÙˆÙŠ) Øº","(ÙŠØ¯ÙˆÙŠ) Ø±","Ù†ØªÙŠØ¬Ø© Ø±","Ù†ØªÙŠØ¬Ø© Øº","Ø§Ù„ØªØµÙ†ÙŠÙ"]];
      merged.forEach((r,idx)=>{
        rows.push([idx+1,r.code_b,r.name_b,r.g_b,r.r_b,r.code_m,r.name_m,r.g_m,r.r_m,(r.r_b===r.r_m)?"Ù…Ø·Ø§Ø¨Ù‚ Ø±":"Ù…Ø®Ø§Ù„Ù Ø±",(r.g_b===r.g_m)?"Ù…Ø·Ø§Ø¨Ù‚ Øº":"Ù…Ø®Ø§Ù„Ù Øº", r.tag]);
      });
      const ws = XLSX.utils.aoa_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©");
      XLSX.writeFile(wb, "canary_monthly_compare.xlsx");
    });

    // ÙÙ„Ø§ØªØ± Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    btns.forEach(b=>{
      b.addEventListener('click', ()=>{
        btns.forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        render();
      });
    });
    q.addEventListener('input', render);

    // Ø±Ø¨Ø· Ø§Ù„Ù‚Ø±Ù‘Ø§Ø¡
    bioFile.addEventListener('change', async e=>{
      const f = e.target.files?.[0];
      if(!f) return;
      bioHint.textContent = "Ø¬Ø§Ø±Ù Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©...";
      try{
        const rows = await readExcel(f);
        bio = rows.map(normalizeRow).filter(x=>x.code || x.name);
        bioHint.textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${f.name} â€” ${bio.length} ØµÙ`;
        merge();
      }catch(err){
        alert("ØªØ¹Ø°Ù‘Ø± Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø©.\n" + err.message);
        bioHint.textContent = "ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„.";
      }
    });

    manFile.addEventListener('change', async e=>{
      const f = e.target.files?.[0];
      if(!f) return;
      manHint.textContent = "Ø¬Ø§Ø±Ù Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©...";
      try{
        const rows = await readExcel(f);
        man = rows.map(normalizeRow).filter(x=>x.code || x.name);
        manHint.textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${f.name} â€” ${man.length} ØµÙ`;
        merge();
      }catch(err){
        alert("ØªØ¹Ø°Ù‘Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ.\n" + err.message);
        manHint.textContent = "ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„.";
      }
    });
  </script>
  <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Excel Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</body>
</html>
