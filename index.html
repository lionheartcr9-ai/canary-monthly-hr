<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <title>Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙƒÙ†Ø§Ø±ÙŠ Ù„Ù„ØµÙ†Ø§Ø¹Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© HR â€” Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</title>

  <!-- SheetJS (XLSX) CDN Ù„Ø¥ØµÙ„Ø§Ø­ XLSX is not defined -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.20.2/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg:#0b1526;
      --card:#101e33;
      --muted:#7fa6ff;
      --text:#e7eefc;
      --sub:#c8d6ff;
      --ok-bg:#0f5132;   --ok-fg:#d1f7df;
      --bad-bg:#5b1116;  --bad-fg:#ffd6d9;
      --miss-bg:#3a3f4a; --miss-fg:#e1e4ea;
      --chip:#1a2b4a; --chip-b:#20355f; --chip-h:#2a447b;
      --accent:#3a66ff;
      --accent-2:#244db8;
      --ring:#2c4786;
      --border:#1b2b44;
      --green:#1faa72;
      --red:#cc3b44;
      --gray:#8896b2;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Kufi Arabic",Tahoma}
    a{color:var(--muted);text-decoration:none}
    .container{max-width:1100px;margin:auto;padding:20px}
    header{margin-bottom:18px}
    .title{font-weight:800;font-size:24px;line-height:1.3}
    .subtitle{color:var(--sub);font-size:14px;margin-top:6px}
    .grid{display:grid;gap:14px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
    .card h3{margin:0 0 10px 0;font-size:18px}
    .drop{border:2px dashed #456; border-radius:14px; padding:16px; text-align:center; color:#cfe2ff; background:#0e1b31;}
    .drop:hover{border-color:#69f; background:#11203a}
    input[type="file"]{display:none}
    label.file{display:block;cursor:pointer;font-weight:700}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .field{flex:1;min-width:180px}
    .search{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--ring);background:#0e1b2c;color:var(--text);outline:none}
    .chips{display:flex;gap:10px;flex-wrap:wrap}
    .chip{background:var(--chip);border:1px solid var(--chip-b);padding:8px 12px;border-radius:999px;color:#cfe2ff;cursor:pointer}
    .chip:active,.chip:hover{background:var(--chip-h)}
    .chip.ok{background:rgba(15,81,50,.18);border-color:#1e6b4b}
    .chip.bad{background:rgba(91,17,22,.18);border-color:#8f1c24}
    .chip.miss{background:rgba(58,63,74,.25);border-color:#4b5160}
    .btn{background:var(--accent);border:1px solid var(--ring);color:white;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn:hover{background:var(--accent-2)}
    .btn.ghost{background:#122038}
    .muted{color:#adc0ff}
    .kpis{display:flex;gap:10px;flex-wrap:wrap}
    .kpi{flex:1;min-width:150px;background:#0e1b31;border:1px solid var(--border);border-radius:14px;padding:12px}
    .kpi h4{margin:0 0 6px 0;font-size:14px;color:#cfe2ff}
    .kpi .n{font-weight:900;font-size:20px}
    .table-wrap{overflow:auto;border-radius:14px;border:1px solid var(--border)}
    table{width:100%;border-collapse:collapse;table-layout:fixed;background:#0e1b31}
    colgroup col.seq{width:56px}
    colgroup col.code{width:100px}
    colgroup col.name{width:auto}
    th{position:sticky;top:0;background:#0b182e;color:#cfe2ff}
    th,td{padding:10px 8px;border-bottom:1px solid var(--border)}
    td.c, th.c{text-align:center;white-space:nowrap}
    td.name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .badge{padding:4px 10px;border-radius:999px;font-weight:700;display:inline-block}
    .badge.ok{background:var(--ok-bg);color:var(--ok-fg)}
    .badge.bad{background:var(--bad-bg);color:var(--bad-fg)}
    .badge.miss{background:var(--miss-bg);color:var(--miss-fg)}
    tr.row-match{background:rgba(16,94,60,.10)}
    tr.row-diff{background:rgba(139,0,0,.08)}
    tr.row-missing{background:rgba(100,100,100,.06)}
    footer{margin:22px 0 8px;color:#aab7d6;font-size:12px;text-align:center}
    footer .sep{opacity:.5;margin:0 6px}
    @media (max-width:420px){
      .title{font-size:20px}
      table{font-size:14px}
      td.name{max-width:220px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙƒÙ†Ø§Ø±ÙŠ Ù„Ù„ØµÙ†Ø§Ø¹Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© <span style="color:#9fc1ff">HR</span> â€” <span style="font-weight:900">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</span></div>
      <div class="subtitle">Ù…Ø·Ø§Ø¨Ù‚Ø©: <b>Ø§Ù„ÙƒÙˆØ¯ + Ø§Ù„Ø§Ø³Ù…</b> Ø«Ù… Ù…Ù‚Ø§Ø±Ù†Ø© <b>Øº / Ø±</b> Ø¨ÙŠÙ† Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø© ÙˆØ§Ù„ÙŠØ¯ÙˆÙŠØŒ Ù…Ø¹ ØªÙ„ÙˆÙŠÙ† ÙˆØ´Ø±Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠ.</div>
    </header>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙØ¹ -->
    <div class="grid">
      <div class="card">
        <h3>ğŸ“ Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø© (Ø´Ù‡Ø±ÙŠ)</h3>
        <label class="drop" for="biometric">
          <label class="file" for="biometric">ğŸ“‚ Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</label>
          <div class="muted" id="bio-status">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù.</div>
        </label>
        <input id="biometric" type="file" accept=".xlsx,.xls,.csv" />
      </div>

      <div class="card">
        <h3>ğŸ“ Ø§Ù„ÙƒØ´Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ (Ø´Ù‡Ø±ÙŠ)</h3>
        <label class="drop" for="manual">
          <label class="file" for="manual">ğŸ“‚ Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</label>
          <div class="muted" id="man-status">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù.</div>
        </label>
        <input id="manual" type="file" accept=".xlsx,.xls,.csv" />
      </div>
    </div>

    <!-- Ø£Ø¯ÙˆØ§Øª -->
    <div class="grid" style="margin-top:12px">
      <div class="card">
        <div class="row">
          <div class="field">
            <input id="q" class="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯..." />
          </div>
          <div class="chips">
            <button id="btn-all" class="chip">Ø§Ù„ÙƒÙ„</button>
            <button id="btn-match" class="chip ok">Ù…Ø·Ø§Ø¨Ù‚</button>
            <button id="btn-diff" class="chip bad">Ù…Ø®Ø§Ù„Ù</button>
            <button id="btn-missing" class="chip miss">Ù†Ø§Ù‚Øµ</button>
          </div>
          <div style="flex:1"></div>
          <button id="btn-export" class="btn">ğŸ’¾ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ XLSX</button>
        </div>
      </div>

      <!-- Ù…Ø¤Ø´Ø±Ø§Øª -->
      <div class="kpis">
        <div class="kpi"><h4>ØªÙ… ØªØ­Ù…ÙŠÙ„:</h4><div class="n"><span id="loaded">0</span> / <span id="total">0</span></div></div>
        <div class="kpi"><h4>Ù…Ø·Ø§Ø¨Ù‚</h4><div class="n" style="color:#73e0a5" id="count-match">0</div></div>
        <div class="kpi"><h4>Ù…Ø®Ø§Ù„Ù</h4><div class="n" style="color:#ff9aa4" id="count-diff">0</div></div>
        <div class="kpi"><h4>Ù†Ø§Ù‚Øµ</h4><div class="n" style="color:#cfd5de" id="count-missing">0</div></div>
      </div>

      <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
      <div class="table-wrap">
        <table>
          <colgroup>
            <col class="seq"><col class="code"><col class="name"><col span="4"><col>
          </colgroup>
          <thead>
            <tr>
              <th class="c">Ù…</th>
              <th class="c">(Ø¨ØµÙ…Ø©) Ø§Ù„ÙƒÙˆØ¯</th>
              <th class="c">(Ø¨ØµÙ…Ø©) Ø§Ù„Ø§Ø³Ù…</th>
              <th class="c">(Ø¨ØµÙ…Ø©) Øº</th>
              <th class="c">(Ø¨ØµÙ…Ø©) Ø±</th>
              <th class="c">(ÙŠØ¯ÙˆÙŠ) Øº</th>
              <th class="c">(ÙŠØ¯ÙˆÙŠ) Ø±</th>
              <th class="c">Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
            </tr>
          </thead>
          <tbody id="result-body">
            <tr><td colspan="8" class="c" style="color:#9fb6e6">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§â€¦</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <footer>
      Â© Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙƒÙ†Ø§Ø±ÙŠ Ù„Ù„ØµÙ†Ø§Ø¹Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© â€” ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­<span class="sep">Â·</span>
      Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©<span class="sep">Â·</span>
      Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³/ Ø­Ù…Ø¯ÙŠ Ø§Ù„Ø¹Ø±ÙŠÙ‚ÙŠ â€” Øª: 773143600<span class="sep">Â·</span>
      Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€” Ù†ÙˆÙÙ…Ø¨Ø± Â© 2025
    </footer>
  </div>

  <script>
    // ================== Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© ==================
    let bioRows = [];     // Ù…Ù† Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø©
    let manRows = [];     // Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ
    let rowsFinal = [];   // Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ù…ÙˆØ­Ù‘Ø¯
    let filterMode = 'all';
    let searchQuery = '';

    // ================== Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ==================
    const $ = sel => document.querySelector(sel);
    function setText(sel, v){ const el=$(sel); if(el) el.textContent=v; }
    const deb = (fn,ms=250)=>{ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms);} };

    // ØªØ­ÙˆÙŠÙ„ Ø±Ù‚Ù… Ø¢Ù…Ù†
    const toNum = v => v === undefined || v === null || v === '' ? null : (isNaN(+v) ? null : +v);

    // Ù‚Ø±Ø§Ø¡Ø© ÙˆØ±Ù‚Ø© (ØªØ­Ø¯ÙŠØ¯ ØµÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§)
    async function parseSheet(file){
      return new Promise((resolve, reject)=>{
        const reader = new FileReader();
        reader.onload = () => {
          try{
            const data = new Uint8Array(reader.result);
            const wb = XLSX.read(data, {type:'array', cellDates:false, codepage:65001});
            const sheet = wb.Sheets[wb.SheetNames[0]];
            const aoa = XLSX.utils.sheet_to_json(sheet, {header:1, raw:true});
            // Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ ÙŠØ­ØªÙˆÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
            const want = ['Ø§Ù„ÙƒÙˆØ¯','Ø§Ù„Ø§Ø³Ù…','Øº','Ø±'];
            let headIdx = -1;
            for(let i=0;i<Math.min(30, aoa.length);i++){
              const row = aoa[i].map(x=> (x||'').toString().trim());
              const ok = want.every(w=> row.includes(w));
              if(ok){ headIdx = i; break; }
            }
            if(headIdx===-1) throw new Error('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ ØµÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯: Ø§Ù„ÙƒÙˆØ¯ | Ø§Ù„Ø§Ø³Ù… | Øº | Ø±');
            const headers = aoa[headIdx];
            const idxCode = headers.findIndex(h=> String(h).trim()==='Ø§Ù„ÙƒÙˆØ¯');
            const idxName = headers.findIndex(h=> String(h).trim()==='Ø§Ù„Ø§Ø³Ù…');
            const idxF    = headers.findIndex(h=> String(h).trim()==='Øº');
            const idxA    = headers.findIndex(h=> String(h).trim()==='Ø±');
            const out=[];
            for(let r=headIdx+1;r<aoa.length;r++){
              const row=aoa[r]||[];
              const code = toNum(row[idxCode]);
              const name = row[idxName]!==undefined ? String(row[idxName]).toString().trim() : '';
              const f = toNum(row[idxF]);
              const a = toNum(row[idxA]);
              if(code || name){ out.push({code, name, f, a}); }
            }
            resolve(out);
          }catch(e){ reject(e); }
        };
        reader.onerror = () => reject(reader.error);
        reader.readAsArrayBuffer(file);
      });
    }

    // Ø¯Ù…Ø¬ ÙˆØ§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
    function buildFinal(){
      const mapBio = new Map();
      for(const r of bioRows){ if(r.code!=null) mapBio.set(r.code, r); }
      const mapMan = new Map();
      for(const r of manRows){ if(r.code!=null) mapMan.set(r.code, r); }

      const allCodes = new Set([...mapBio.keys(), ...mapMan.keys()]);
      const res=[];
      for(const code of allCodes){
        const b = mapBio.get(code);
        const m = mapMan.get(code);
        const name = (b?.name || m?.name || '').toString().trim();
        const f_b = b?.f ?? null;
        const a_b = b?.a ?? null;
        const f_m = m?.f ?? null;
        const a_m = m?.a ?? null;

        let status = 'match';
        if(f_b==null || a_b==null || f_m==null || a_m==null){
          status = 'missing';
        }else{
          const sameF = (f_b === f_m);
          const sameA = (a_b === a_m);
          status = (sameF && sameA) ? 'match' : 'diff';
        }
        res.push({code, name, f_b, a_b, f_m, a_m, status});
      }
      // ÙØ±Ø² Ù…Ø¨Ø¯Ø¦ÙŠ
      res.sort((a,b)=> (a.code||0) - (b.code||0));
      rowsFinal = res;
    }

    // Ø¹Ø¯Ù‘Ø§Ø¯Ø§Øª
    function updateCounters(view){
      const total   = view.length;
      const match   = view.filter(r=>r.status==='match').length;
      const diff    = view.filter(r=>r.status==='diff').length;
      const missing = view.filter(r=>r.status==='missing').length;
      setText('#count-match', match);
      setText('#count-diff', diff);
      setText('#count-missing', missing);
      setText('#loaded', (bioRows.length && manRows.length) ? rowsFinal.length : 0);
      setText('#total', rowsFinal.length || 0);
    }

    // Ø±ENDER
    function statusClass(st){ return st==='match'?'ok':st==='diff'?'bad':'miss'; }
    function statusLabel(st){ return st==='match'?'Ù…Ø·Ø§Ø¨Ù‚':st==='diff'?'Ù…Ø®Ø§Ù„Ù':'Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©'; }

    function renderTable(){
      // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      let view = rowsFinal.filter(r=>{
        if(filterMode==='match') return r.status==='match';
        if(filterMode==='diff') return r.status==='diff';
        if(filterMode==='missing') return r.status==='missing';
        return true;
      });

      // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ø­Ø«
      const q = searchQuery.trim();
      if(q){
        const qn = Number(q);
        view = view.filter(r=>{
          if(!isNaN(qn)) return (r.code===qn);
          return (r.name||'').includes(q);
        });
      }

      // ÙØ±Ø² ÙˆØ¶Ø¨Ø· Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ³Ù„Ø³Ù„
      view.sort((a,b)=> (a.code||0)-(b.code||0));
      view.forEach((r,i)=> r.seq=i+1);

      const tbody = $('#result-body');
      tbody.innerHTML = '';
      if(view.length===0){
        const tr=document.createElement('tr');
        tr.innerHTML=`<td colspan="8" class="c" style="color:#9fb6e6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</td>`;
        tbody.appendChild(tr);
      }else{
        for(const r of view){
          const tr=document.createElement('tr');
          tr.className = r.status==='match'?'row-match':r.status==='diff'?'row-diff':'row-missing';
          tr.innerHTML = `
            <td class="c">${r.seq}</td>
            <td class="c">${r.code ?? ''}</td>
            <td class="name">${r.name ?? ''}</td>
            <td class="c">${r.f_b ?? ''}</td>
            <td class="c">${r.a_b ?? ''}</td>
            <td class="c">${r.f_m ?? ''}</td>
            <td class="c">${r.a_m ?? ''}</td>
            <td class="c"><span class="badge ${statusClass(r.status)}">${statusLabel(r.status)}</span></td>
          `;
          tbody.appendChild(tr);
        }
      }
      updateCounters(view);
    }

    // ØªØµØ¯ÙŠØ±
    function exportXLSX(){
      if(!rowsFinal.length){ alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.'); return; }
      // Ø¨Ù†ÙŠ Ø¹Ø±Ø¶Ù‹Ø§ Ù…ÙˆØ§ÙÙ‚Ù‹Ø§ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù†ÙØ³ renderTable)
      let view = rowsFinal.filter(r=>{
        if(filterMode==='match') return r.status==='match';
        if(filterMode==='diff') return r.status==='diff';
        if(filterMode==='missing') return r.status==='missing';
        return true;
      });
      const q=searchQuery.trim();
      if(q){
        const qn=Number(q);
        view = view.filter(r=> isNaN(qn) ? (r.name||'').includes(q) : (r.code===qn));
      }
      view.sort((a,b)=> (a.code||0)-(b.code||0));
      view.forEach((r,i)=> r.seq=i+1);

      const data = view.map(r=>({
        "Ù…": r.seq,
        "Ø§Ù„ÙƒÙˆØ¯ (Ø¨ØµÙ…Ø©)": r.code ?? "",
        "Ø§Ù„Ø§Ø³Ù… (Ø¨ØµÙ…Ø©)": r.name ?? "",
        "Øº (Ø¨ØµÙ…Ø©)": r.f_b ?? "",
        "Ø± (Ø¨ØµÙ…Ø©)": r.a_b ?? "",
        "Øº (ÙŠØ¯ÙˆÙŠ)": r.f_m ?? "",
        "Ø± (ÙŠØ¯ÙˆÙŠ)": r.a_m ?? "",
        "Ø§Ù„Ù†ØªÙŠØ¬Ø©": statusLabel(r.status)
      }));
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©");
      XLSX.writeFile(wb, "canary_monthly_compare.xlsx");
    }

    // ================== Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ==================
    $('#biometric').addEventListener('change', async (e)=>{
      const file = e.target.files[0];
      if(!file) return;
      $('#bio-status').textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${file.name}`;
      try{
        bioRows = await parseSheet(file);
      }catch(err){
        alert("ØªØ¹Ø°Ù‘Ø± Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø©.\n" + err.message);
        bioRows = [];
      }
      buildFinal(); renderTable();
    });

    $('#manual').addEventListener('change', async (e)=>{
      const file = e.target.files[0];
      if(!file) return;
      $('#man-status').textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${file.name}`;
      try{
        manRows = await parseSheet(file);
      }catch(err){
        alert("ØªØ¹Ø°Ù‘Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ.\n" + err.message);
        manRows = [];
      }
      buildFinal(); renderTable();
    });

    $('#btn-all').onclick      = ()=>{ filterMode='all';     renderTable(); };
    $('#btn-match').onclick    = ()=>{ filterMode='match';   renderTable(); };
    $('#btn-diff').onclick     = ()=>{ filterMode='diff';    renderTable(); };
    $('#btn-missing').onclick  = ()=>{ filterMode='missing'; renderTable(); };
    $('#btn-export').onclick   = exportXLSX;

    $('#q').addEventListener('input', deb((e)=>{ searchQuery = e.target.value; renderTable(); }, 200));

    // Ù†ØµØ§Ø¦Ø­ Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯: Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù…Ù† Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù† Ø£Ù…ÙƒÙ†
    // Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø±ÙØ¹ Ù„Ø§Ø®ØªÙŠØ§Ø±Ù‡.
  </script>
</body>
</html>
