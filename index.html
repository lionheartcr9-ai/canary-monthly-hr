<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Canary HR â€“ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</title>

  <!-- Ø«ÙŠÙ… Ø£Ø²Ø±Ù‚ Ø¨Ø³ÙŠØ· -->
  <style>
    :root{
      --bg:#0f1a22; --card:#12212b; --text:#eaf2f6; --muted:#a9c0cc;
      --line:#234252; --btn:#0c2733; --ok:#1f7a4d; --bad:#7a1f2a; --miss:#666a72;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--text); font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Arial}
    .top{padding:16px 20px; border-bottom:1px solid var(--line)}
    .title{margin:0; font-size:20px; line-height:1.4}
    .sub{color:var(--muted); font-size:14px}
    .wrap{max-width:1100px; margin:22px auto; padding:0 14px}
    .card{background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px; margin-bottom:14px}
    .card h2{margin:0 0 10px; font-size:18px}
    .grid{display:grid; gap:12px}
    .grid.cols-2{grid-template-columns:1fr 1fr}
    .field{display:flex; flex-direction:column; gap:6px}
    .label{font-size:14px; color:var(--muted)}
    input[type="file"]{padding:10px; border:1px dashed var(--line); border-radius:10px; background:#0b1f28; color:var(--text)}
    .actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{padding:10px 14px; border:1px solid var(--line); background:var(--btn); color:var(--text); border-radius:10px; cursor:pointer}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .sum{margin-top:4px; color:var(--muted)}
    .note{color:var(--muted); font-size:13px}

    /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
    .table-wrap{overflow:auto; border:1px solid var(--line); border-radius:12px}
    table{width:max-content; min-width:100%; border-collapse:separate; border-spacing:0}
    thead th{position:sticky; top:0; background:#0e1b22; padding:10px 8px; border-bottom:1px solid var(--line); white-space:nowrap; text-align:center}
    tbody td{padding:10px 8px; border-bottom:1px solid var(--line); text-align:center}
    td.name{min-width:220px; text-align:right; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    td.note{min-width:320px; text-align:right; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    td.res-ok   { background:rgba(31,122,77,.28); }
    td.res-bad  { background:rgba(122,31,42,.28); }
    td.res-miss { background:rgba(102,106,114,.28); }

    .foot{padding:16px 10px; text-align:center; color:var(--muted); border-top:1px solid var(--line); margin-top:18px; line-height:1.9}
    @media (max-width:700px){
      .grid.cols-2{grid-template-columns:1fr}
      td.name{min-width:260px}
      td.note{min-width:360px}
    }
  </style>

  <!-- Ù…ÙƒØªØ¨Ø© Excel (XLSX) Ù…Ù† CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>

  <header class="top">
    <h1 class="title">Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙƒÙ†Ø§Ø±ÙŠ Ù„Ù„ØµÙ†Ø§Ø¹Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© HR â€” Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h1>
    <div class="sub">Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¨ØµÙ…Ø© (Øº/Ø±) Ù…Ø¹ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©</div>
  </header>

  <main class="wrap">
    <!-- Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª -->
    <section class="card">
      <h2>ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª (XLSX)</h2>
      <div class="grid cols-2">
        <div class="field">
          <label class="label">ğŸ“‚ Ù…Ù„Ù Ø§Ù„Ø¨ØµÙ…Ø© (XLSX) â€” Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ø§Ù„ÙƒÙˆØ¯ | Ø§Ù„Ø§Ø³Ù… | Øº | Ø±</label>
          <input id="fingerFile" type="file" accept=".xlsx" />
        </div>
        <div class="field">
          <label class="label">ğŸ“‚ Ø§Ù„ÙƒØ´Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ (XLSX) â€” Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ø§Ù„ÙƒÙˆØ¯ | Ø§Ù„Ø§Ø³Ù… | Øº | Ø±</label>
          <input id="manualFile" type="file" accept=".xlsx" />
        </div>
      </div>
      <div class="actions" style="margin-top:10px">
        <button id="compareBtn" class="btn">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</button>
        <button id="exportBtn" class="btn" disabled>ğŸ’¾ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ XLSX</button>
        <span id="summary" class="sum"></span>
      </div>
      <div class="note">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ ÙŠØªÙ… Ø±ÙØ¹ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø®Ø§Ø¯Ù… â€” ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØªÙ… Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­.</div>
    </section>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <section class="card">
      <h2>Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Ø§Ù„ÙƒÙˆØ¯</th>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Øº (Ø¨ØµÙ…Ø©)</th>
              <th>Øº (ÙŠØ¯ÙˆÙŠ)</th>
              <th>Ù†ØªÙŠØ¬Ø© Øº</th>
              <th>Ø± (Ø¨ØµÙ…Ø©)</th>
              <th>Ø± (ÙŠØ¯ÙˆÙŠ)</th>
              <th>Ù†ØªÙŠØ¬Ø© Ø±</th>
              <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th>
            </tr>
          </thead>
          <tbody id="resultsTable"></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="foot">
    Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© - Ø§Ù„ÙŠÙ…Ù†<br/>
    Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³/ Ø­Ù…Ø¯ÙŠ Ø§Ù„Ø¹Ø±ÙŠÙ‚ÙŠ Øª: 7773143600<br/>
    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù†ÙˆÙÙ…Ø¨Ø± 2025Ù…
  </footer>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <script>
    // âœ… Ø¯Ø§Ù„Ø© Ù„ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø¹Ø´Ø±ÙŠØ© Ø¨Ø¯Ù‚Ø© (Ù…Ø«Ù„Ø§Ù‹ 6.500000625 â†’ 6.5)
    const roundValue = (num) => {
      if (num === "" || num === null || isNaN(num)) return 0;
      return Math.round((parseFloat(num) + Number.EPSILON) * 100) / 100;
    };

    // âœ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel ÙˆØ¥Ø±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ ÙƒÙ…ØµÙÙˆÙØ© ÙƒØ§Ø¦Ù†Ø§Øª
    async function readExcel(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          try{
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: "array" });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(firstSheet, { defval:"" });
            // ØªØ­Ù‚Ù‘Ù‚ Ù…Ù† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const required = ["Ø§Ù„ÙƒÙˆØ¯","Ø§Ù„Ø§Ø³Ù…","Øº","Ø±"];
            const header = rows.length ? Object.keys(rows[0]) : [];
            const ok = required.every(k => header.includes(k));
            if(!ok) throw new Error("ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ø§Ù„ÙƒÙˆØ¯ | Ø§Ù„Ø§Ø³Ù… | Øº | Ø±");
            resolve(rows);
          }catch(err){ reject(err); }
        };
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
      });
    }

    // âœ… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ù…Ù„ÙÙŠ Ø§Ù„Ø¨ØµÙ…Ø© ÙˆØ§Ù„ÙŠØ¯ÙˆÙŠ
    function compareRecords(fingerprint, manual) {
      const results = [];

      fingerprint.forEach((f) => {
        // Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø§Ø³Ù…
        const match = manual.find(
          (m) => String(m["Ø§Ù„ÙƒÙˆØ¯"]) === String(f["Ø§Ù„ÙƒÙˆØ¯"]) && m["Ø§Ù„Ø§Ø³Ù…"] === f["Ø§Ù„Ø§Ø³Ù…"]
        );

        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ ØªØ·Ø§Ø¨Ù‚ â†’ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©
        if (!match) {
          results.push({
            Ø§Ù„ÙƒÙˆØ¯: f["Ø§Ù„ÙƒÙˆØ¯"],
            Ø§Ù„Ø§Ø³Ù…: f["Ø§Ù„Ø§Ø³Ù…"],
            "Øº (Ø¨ØµÙ…Ø©)": f["Øº"],
            "Ø± (Ø¨ØµÙ…Ø©)": f["Ø±"],
            "Øº (ÙŠØ¯ÙˆÙŠ)": "",
            "Ø± (ÙŠØ¯ÙˆÙŠ)": "",
            "Ù†ØªÙŠØ¬Ø© Øº": "Ù†Ø§Ù‚Øµ",
            "Ù†ØªÙŠØ¬Ø© Ø±": "Ù†Ø§Ù‚Øµ",
            Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©: "Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ© Ø£Ùˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„ÙƒØ´Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ",
          });
          return;
        }

        // ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ù‚ÙŠÙ… Ù„ØªÙØ§Ø¯ÙŠ ÙØ±ÙˆÙ‚ Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø¹Ø´Ø±ÙŠØ©
        const g_f = roundValue(f["Øº"]);
        const g_m = roundValue(match["Øº"]);
        const r_f = roundValue(f["Ø±"]);
        const r_m = roundValue(match["Ø±"]);

        let resultG = "";
        let resultR = "";
        let note = "";

        // âœ… Ù…Ù‚Ø§Ø±Ù†Ø© Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨ (Øº)
        if (g_f === g_m) {
          resultG = "Ù…Ø·Ø§Ø¨Ù‚";
        } else if (g_f > g_m) {
          resultG = "Ù…Ø®Ø§Ù„Ù";
          note = "ÙŠØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Øº";
        } else if (g_f < g_m) {
          resultG = "Ù…Ø®Ø§Ù„Ù";
          note = `Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ø¯Ø®Ø§Ù„ ÙŠØªÙ… Ø¹Ù…Ù„ Ø§Ø³ØªÙŠÙØ§Ø¡ Øº Ø¨Ø§Ù„ÙØ§Ø±Ù‚ ${(g_m - g_f).toFixed(1)}`;
        }

        // âœ… Ù…Ù‚Ø§Ø±Ù†Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª (Ø±)
        if (r_f === r_m) {
          resultR = "Ù…Ø·Ø§Ø¨Ù‚";
        } else if (r_f > r_m) {
          resultR = "Ù…Ø®Ø§Ù„Ù";
          if (!note) note = "ÙŠØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø±";
        } else if (r_f < r_m) {
          resultR = "Ù…Ø®Ø§Ù„Ù";
          if (!note) note = `Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ø¯Ø®Ø§Ù„ ÙŠØªÙ… Ø¹Ù…Ù„ Ø± Ø¨Ø§Ù„ÙØ§Ø±Ù‚ ${(r_m - r_f).toFixed(1)}`;
        }

        // âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        results.push({
          Ø§Ù„ÙƒÙˆØ¯: f["Ø§Ù„ÙƒÙˆØ¯"],
          Ø§Ù„Ø§Ø³Ù…: f["Ø§Ù„Ø§Ø³Ù…"],
          "Øº (Ø¨ØµÙ…Ø©)": g_f,
          "Ø± (Ø¨ØµÙ…Ø©)": r_f,
          "Øº (ÙŠØ¯ÙˆÙŠ)": g_m,
          "Ø± (ÙŠØ¯ÙˆÙŠ)": r_m,
          "Ù†ØªÙŠØ¬Ø© Øº": resultG,
          "Ù†ØªÙŠØ¬Ø© Ø±": resultR,
          Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©: note || "Ù…Ø·Ø§Ø¨Ù‚",
        });
      });

      // ÙØ±Ø² ØªØµØ§Ø¹Ø¯ÙŠ Ø­Ø³Ø¨ Ø§Ù„ÙƒÙˆØ¯ (ÙƒØ£Ø±Ù‚Ø§Ù… Ø¥Ù† Ø£Ù…ÙƒÙ†)
      results.sort((a,b)=>{
        const x = Number(a["Ø§Ù„ÙƒÙˆØ¯"]) || 0;
        const y = Number(b["Ø§Ù„ÙƒÙˆØ¯"]) || 0;
        return x - y;
      });

      return results;
    }

    // âœ… Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©
    function displayResults(results) {
      const tableBody = document.getElementById("resultsTable");
      tableBody.innerHTML = "";

      results.forEach((r) => {
        const row = document.createElement("tr");

        const clsG = r["Ù†ØªÙŠØ¬Ø© Øº"] === "Ù…Ø·Ø§Ø¨Ù‚" ? "res-ok" : (r["Ù†ØªÙŠØ¬Ø© Øº"] === "Ù†Ø§Ù‚Øµ" ? "res-miss" : "res-bad");
        const clsR = r["Ù†ØªÙŠØ¬Ø© Ø±"] === "Ù…Ø·Ø§Ø¨Ù‚" ? "res-ok" : (r["Ù†ØªÙŠØ¬Ø© Ø±"] === "Ù†Ø§Ù‚Øµ" ? "res-miss" : "res-bad");

        row.innerHTML = `
          <td>${r["Ø§Ù„ÙƒÙˆØ¯"]}</td>
          <td class="name" title="${r["Ø§Ù„Ø§Ø³Ù…"]}">${r["Ø§Ù„Ø§Ø³Ù…"]}</td>
          <td>${r["Øº (Ø¨ØµÙ…Ø©)"]}</td>
          <td>${r["Øº (ÙŠØ¯ÙˆÙŠ)"]}</td>
          <td class="${clsG}">${r["Ù†ØªÙŠØ¬Ø© Øº"]}</td>
          <td>${r["Ø± (Ø¨ØµÙ…Ø©)"]}</td>
          <td>${r["Ø± (ÙŠØ¯ÙˆÙŠ)"]}</td>
          <td class="${clsR}">${r["Ù†ØªÙŠØ¬Ø© Ø±"]}</td>
          <td class="note" title="${r["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©"]}">${r["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©"]}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    // âœ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ Ù…Ù„Ù Excel
    function exportToExcel(results) {
      // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù„Ø¶Ù…Ø§Ù† Ù†ÙØ³ Ø§Ù„ØªØ±ØªÙŠØ¨ ÙÙŠ Ø§Ù„Ù…Ù„Ù
      const ordered = results.map(r => ({
        "Ø§Ù„ÙƒÙˆØ¯": r["Ø§Ù„ÙƒÙˆØ¯"],
        "Ø§Ù„Ø§Ø³Ù…": r["Ø§Ù„Ø§Ø³Ù…"],
        "Øº (Ø¨ØµÙ…Ø©)": r["Øº (Ø¨ØµÙ…Ø©)"],
        "Ø± (Ø¨ØµÙ…Ø©)": r["Ø± (Ø¨ØµÙ…Ø©)"],
        "Øº (ÙŠØ¯ÙˆÙŠ)": r["Øº (ÙŠØ¯ÙˆÙŠ)"],
        "Ø± (ÙŠØ¯ÙˆÙŠ)": r["Ø± (ÙŠØ¯ÙˆÙŠ)"],
        "Ù†ØªÙŠØ¬Ø© Øº": r["Ù†ØªÙŠØ¬Ø© Øº"],
        "Ù†ØªÙŠØ¬Ø© Ø±": r["Ù†ØªÙŠØ¬Ø© Ø±"],
        "Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©": r["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©"]
      }));
      const ws = XLSX.utils.json_to_sheet(ordered, { cellDates:false });
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©");
      XLSX.writeFile(wb, "canary_monthly_result.xlsx");
    }

    // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
    document.getElementById("compareBtn").addEventListener("click", async () => {
      const fingerprintFile = document.getElementById("fingerFile").files[0];
      const manualFile = document.getElementById("manualFile").files[0];

      if (!fingerprintFile || !manualFile) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹ (Ø§Ù„Ø¨ØµÙ…Ø© ÙˆØ§Ù„ÙŠØ¯ÙˆÙŠ) â€” Ø¨ØµÙŠØºØ© XLSX ÙˆØ¨Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ø§Ù„ÙƒÙˆØ¯ | Ø§Ù„Ø§Ø³Ù… | Øº | Ø±");
        return;
      }

      try{
        const fingerprint = await readExcel(fingerprintFile);
        const manual = await readExcel(manualFile);
        const results = compareRecords(fingerprint, manual);

        displayResults(results);

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
        const total = results.length;
        const matching = results.filter((r) => r["Ù†ØªÙŠØ¬Ø© Øº"] === "Ù…Ø·Ø§Ø¨Ù‚" && r["Ù†ØªÙŠØ¬Ø© Ø±"] === "Ù…Ø·Ø§Ø¨Ù‚").length;
        const diff = results.filter((r) => r["Ù†ØªÙŠØ¬Ø© Øº"] === "Ù…Ø®Ø§Ù„Ù" || r["Ù†ØªÙŠØ¬Ø© Ø±"] === "Ù…Ø®Ø§Ù„Ù").length;
        const missing = results.filter((r) => r["Ù†ØªÙŠØ¬Ø© Øº"] === "Ù†Ø§Ù‚Øµ" || r["Ù†ØªÙŠØ¬Ø© Ø±"] === "Ù†Ø§Ù‚Øµ").length;

        document.getElementById("summary").innerHTML =
          `<b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</b> ${total} &nbsp; | &nbsp; <b>Ù…Ø·Ø§Ø¨Ù‚:</b> ${matching} &nbsp; | &nbsp; <b>Ù…Ø®Ø§Ù„Ù:</b> ${diff} &nbsp; | &nbsp; <b>Ù†Ø§Ù‚Øµ:</b> ${missing}`;

        // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±
        window.lastResults = results;
        document.getElementById("exportBtn").disabled = results.length === 0;
      }catch(err){
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª: " + err.message);
      }
    });

    // âœ… Ø²Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¥Ù„Ù‰ Ù…Ù„Ù Excel
    document.getElementById("exportBtn").addEventListener("click", () => {
      if (!window.lastResults || window.lastResults.length === 0) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹.");
        return;
      }
      exportToExcel(window.lastResults);
    });
  </script>
</body>
</html>
